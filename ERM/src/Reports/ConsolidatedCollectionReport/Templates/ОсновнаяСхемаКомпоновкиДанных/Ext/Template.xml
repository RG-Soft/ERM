<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных1</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>Client</dataPath>
			<field>Client</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>SubSubSegment</dataPath>
			<field>SubSubSegment</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>AU</dataPath>
			<field>AU</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Source</dataPath>
			<field>Source</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Currency</dataPath>
			<field>Currency</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Location</dataPath>
			<field>Location</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Invoice</dataPath>
			<field>Invoice</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Account</dataPath>
			<field>Account</field>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Company</dataPath>
			<field>Company</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>CustomerID</dataPath>
			<field>CustomerID</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Customer ID</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>AmountОстаток</dataPath>
			<field>AmountОстаток</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>CompanyCode</dataPath>
			<field>CompanyCode</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Company code</v8:content>
				</v8:item>
			</title>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>РегистраторTranAmount</dataPath>
			<field>РегистраторTranAmount</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>РегистраторCurrency</dataPath>
			<field>РегистраторCurrency</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>РегистраторAccountingPeriod</dataPath>
			<field>РегистраторAccountingPeriod</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>AmountОстатокUSD</dataPath>
			<field>AmountОстатокUSD</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Amount остаток USD</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Курс</dataPath>
			<field>Курс</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Кратность</dataPath>
			<field>Кратность</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>РегистраторAmountUSD</dataPath>
			<field>РегистраторAmountUSD</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Регистратор amount USD</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>BaseCurrencyEquivalent</dataPath>
			<field>BaseCurrencyEquivalent</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Base currency equivalent</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ClientName</dataPath>
			<field>ClientName</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Client name</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>LegalEntity</dataPath>
			<field>LegalEntity</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Legal entity</v8:content>
				</v8:item>
			</title>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ
	BilledARОстатки.Company КАК CompanyCode,
	BilledARОстатки.Client КАК Client,
	BilledARОстатки.Source КАК Source,
	BilledARОстатки.Location КАК Location,
	BilledARОстатки.SubSubSegment КАК SubSubSegment,
	BilledARОстатки.Invoice КАК Invoice,
	BilledARОстатки.Account КАК Account,
	BilledARОстатки.Currency КАК Currency,
	BilledARОстатки.AU КАК AU,
	BilledARОстатки.AmountОстаток КАК AmountОстаток,
	ВЫБОР
		КОГДА BilledARОстатки.Currency = &amp;USD
			ТОГДА BilledARОстатки.AmountОстаток
		ИНАЧЕ BilledARОстатки.AmountОстаток / ВнутренниеКурсыВалютСрезПоследних.Курс * ВнутренниеКурсыВалютСрезПоследних.Кратность
	КОНЕЦ КАК AmountОстатокUSD,
	ВнутренниеКурсыВалютСрезПоследних.Курс,
	ВнутренниеКурсыВалютСрезПоследних.Кратность
ПОМЕСТИТЬ Остатки
ИЗ
	РегистрНакопления.BilledAR.Остатки КАК BilledARОстатки,
	РегистрСведений.ВнутренниеКурсыВалют.СрезПоследних(, Валюта = &amp;USD) КАК ВнутренниеКурсыВалютСрезПоследних
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	НастройкаСинхронизацииОбъектовСВнешнимиСистемамиСрезПоследних.Идентификатор КАК Идентификатор,
	НастройкаСинхронизацииОбъектовСВнешнимиСистемамиСрезПоследних.ОбъектПриемника КАК ОбъектПриемника,
	НастройкаСинхронизацииОбъектовСВнешнимиСистемамиСрезПоследних.ТипСоответствия КАК ТипСоответствия
ПОМЕСТИТЬ ВТ_НастройкиСинхронизации
ИЗ
	РегистрСведений.НастройкаСинхронизацииОбъектовСВнешнимиСистемами.СрезПоследних(
			,
			ТипОбъектаВнешнейСистемы = ЗНАЧЕНИЕ(Перечисление.ТипыОбъектовВнешнихСистем.Client)
				И (ТипСоответствия, ОбъектПриемника) В
					(ВЫБРАТЬ
						Остатки.Source,
						Остатки.Client
					ИЗ
						Остатки КАК Остатки)) КАК НастройкаСинхронизацииОбъектовСВнешнимиСистемамиСрезПоследних

ИНДЕКСИРОВАТЬ ПО
	ТипСоответствия,
	ОбъектПриемника
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	BilledAR.Invoice,
	BilledAR.Регистратор.TranAmount,
	BilledAR.Регистратор.Currency,
	BilledAR.Регистратор.AccountingPeriod,
	ВЫБОР
		КОГДА BilledAR.Регистратор.Currency = &amp;USD
			ТОГДА BilledAR.Регистратор.TranAmount
		ИНАЧЕ BilledAR.Регистратор.TranAmount / ВнутренниеКурсыВалютСрезПоследних.Курс * ВнутренниеКурсыВалютСрезПоследних.Кратность
	КОНЕЦ КАК РегистраторAmountUSD
ПОМЕСТИТЬ ВТ_ЦенаДата
ИЗ
	РегистрНакопления.BilledAR КАК BilledAR,
	РегистрСведений.ВнутренниеКурсыВалют.СрезПоследних(, Валюта = &amp;USD) КАК ВнутренниеКурсыВалютСрезПоследних
ГДЕ
	BilledAR.Регистратор.System = "AR"
	И (BilledAR.Регистратор.SourceCode = "RL"
			ИЛИ BilledAR.Регистратор.SourceCode = "RY")
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Остатки.CompanyCode,
	Остатки.CompanyCode.Наименование КАК LegalEntity,
	Остатки.Client,
	Остатки.Client.Наименование КАК ClientName,
	Остатки.Source,
	Остатки.Location,
	Остатки.SubSubSegment,
	Остатки.Account,
	Остатки.Invoice,
	Остатки.AU,
	Остатки.Currency,
	Остатки.AmountОстаток,
	Остатки.AmountОстатокUSD,
	ВТ_НастройкиСинхронизации.Идентификатор КАК CustomerID,
	ВТ_ЦенаДата.РегистраторTranAmount,
	ВТ_ЦенаДата.РегистраторCurrency,
	ВТ_ЦенаДата.РегистраторAccountingPeriod,
	Остатки.Курс,
	Остатки.Кратность,
	ВТ_ЦенаДата.РегистраторAmountUSD,
	ВЫБОР
		КОГДА ВТ_ЦенаДата.РегистраторTranAmount &gt; 0
			ТОГДА ВТ_ЦенаДата.РегистраторAmountUSD / Остатки.Курс
		ИНАЧЕ ВТ_ЦенаДата.РегистраторTranAmount
	КОНЕЦ КАК BaseCurrencyEquivalent
ИЗ
	Остатки КАК Остатки
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_НастройкиСинхронизации КАК ВТ_НастройкиСинхронизации
		ПО Остатки.Source = ВТ_НастройкиСинхронизации.ТипСоответствия
			И Остатки.Client = ВТ_НастройкиСинхронизации.ОбъектПриемника
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ЦенаДата КАК ВТ_ЦенаДата
		ПО Остатки.Invoice = ВТ_ЦенаДата.Invoice</query>
	</dataSet>
	<parameter>
		<name>Период</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Период</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
	</parameter>
	<parameter>
		<name>USD</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>USD</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.Валюты</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>false</useRestriction>
		<expression>Справочники.Валюты.НайтиПоКоду("840")</expression>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="xs:string">Основной</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:dataParameters>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:use>false</dcscor:use>
					<dcscor:parameter>USD</dcscor:parameter>
					<dcscor:value xsi:type="xs:dateTime">0001-01-01T00:00:00</dcscor:value>
				</dcscor:item>
			</dcsset:dataParameters>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>Location.БазовыйЭлемент.GeoMarket.Родитель</dcsset:field>
						<dcsset:lwsTitle>
							<v8:item>
								<v8:lang>ru</v8:lang>
								<v8:content>Geo Market</v8:content>
							</v8:item>
						</dcsset:lwsTitle>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>LegalEntity</dcsset:field>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>CompanyCode</dcsset:field>
						<dcsset:lwsTitle>
							<v8:item>
								<v8:lang>ru</v8:lang>
								<v8:content>Company Code</v8:content>
							</v8:item>
						</dcsset:lwsTitle>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>ClientName</dcsset:field>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>Client</dcsset:field>
						<dcsset:lwsTitle>
							<v8:item>
								<v8:lang>ru</v8:lang>
								<v8:content>Client ID</v8:content>
							</v8:item>
						</dcsset:lwsTitle>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>CustomerID</dcsset:field>
						<dcsset:lwsTitle>
							<v8:item>
								<v8:lang>ru</v8:lang>
								<v8:content>UID</v8:content>
							</v8:item>
						</dcsset:lwsTitle>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>Source</dcsset:field>
						<dcsset:lwsTitle>
							<v8:item>
								<v8:lang>ru</v8:lang>
								<v8:content>ERP</v8:content>
							</v8:item>
						</dcsset:lwsTitle>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>SubSubSegment.БазовыйЭлемент.Родитель.Родитель</dcsset:field>
						<dcsset:lwsTitle>
							<v8:item>
								<v8:lang>ru</v8:lang>
								<v8:content>Segment</v8:content>
							</v8:item>
						</dcsset:lwsTitle>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>Invoice</dcsset:field>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>РегистраторAccountingPeriod</dcsset:field>
						<dcsset:lwsTitle>
							<v8:item>
								<v8:lang>ru</v8:lang>
								<v8:content>Date of Collection</v8:content>
							</v8:item>
						</dcsset:lwsTitle>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>РегистраторTranAmount</dcsset:field>
						<dcsset:lwsTitle>
							<v8:item>
								<v8:lang>ru</v8:lang>
								<v8:content>Collected amount</v8:content>
							</v8:item>
						</dcsset:lwsTitle>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>РегистраторAmountUSD</dcsset:field>
						<dcsset:lwsTitle>
							<v8:item>
								<v8:lang>ru</v8:lang>
								<v8:content>Collected amount USD</v8:content>
							</v8:item>
						</dcsset:lwsTitle>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>Currency</dcsset:field>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>Курс</dcsset:field>
					</dcsset:item>
					<dcsset:item xsi:type="dcsset:SelectedItemField">
						<dcsset:field>BaseCurrencyEquivalent</dcsset:field>
					</dcsset:item>
				</dcsset:selection>
				<dcsset:outputParameters>
					<dcscor:item xsi:type="dcsset:SettingsParameterValue">
						<dcscor:parameter>МакетОформления</dcscor:parameter>
						<dcscor:value xsi:type="xs:string">Море</dcscor:value>
					</dcscor:item>
				</dcsset:outputParameters>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>